/*! tulito.js
 * http://tulito.org
 *
 * Copyright (c) 2013-2014 Danny Brian <danny@brians.org>;
 * Licensed under the MIT license */(function(e,t){"use strict";var n=70,r=new Object,i=function(){this._inits=new Object;var i=this,s={openedPaneGap:150,openedHiddenPaneGap:24,shovedPaneGap:90,onOrientationChange:null,onHiddenPaneShown:null,onHiddenPaneHidden:null,onBackPaneShown:null,onBackPaneHidden:null,noReorient:!1};return this.init=function(t){this.options={};for(var n in s)n in t?this.options[n]=t[n]:this.options[n]=s[n];this.options.shovedHiddenRatio=this.options.shovedPaneGap/(e.innerWidth-this.options.openedHiddenPaneGap),this.options.shovedPaneRatio=this.options.shovedPaneGap/(e.innerWidth-this.options.openedPaneGap),this.realCordova=document.URL.indexOf("http://")===-1&&document.URL.indexOf("https://")===-1,document.ontouchmove=function(e){e.srcElement.hasAttribute("data-tulito-touchdefault")||e.preventDefault()},this.realCordova?(this.options.noReorient||this._orient(),setTimeout(function(){navigator.splashscreen&&navigator.splashscreen.hide()},100)):(e.addEventListener("load",i._orient,!1),this.options.noReorient||e.addEventListener("orientationchange",i._orient,!1));var r=document.querySelectorAll("[data-tulito-class]");for(var o=0;o<r.length;++o)this.apply(r[o]);var u=document.querySelectorAll('[data-tulito-touchdefault="cascade"] *');for(var o=0;o<u.length;++o)u[o].setAttribute("data-tulito-touchdefault","yes");var a=document.querySelectorAll(".scrollable");for(var o=0;o<a.length;++o)new ScrollFix(a[o]),a[o].ontouchmove=function(e){e.stopPropagation()};var f=document.querySelectorAll('[data-tulito-drag="never"]');for(var o=0;o<f.length;++o)f[o].ontouchmove=function(e){e.preventDefault(),e.stopPropagation()}},this.apply=function(e){var t=e.getAttribute("data-tulito-class");i._inits[t]?i._inits[t](e):console.log("tulito class not found: "+t)},this.on=function(e){},this.toggleOpen=function(e){i._togglePane(e)},this.toggleEnable=function(e){},this.state=function(e){},this._inits.scrollable=function(t){var n=new IScroll(t,{eventPassthrough:!0,scrollY:!0,scrollX:!1,snap:!0,snapStepX:e.innerWidth-31,deceleration:.008});setInterval(function(){console.log(n),n.refresh()},2e3)},this._inits.button=function(e){Hammer(e).on("touch",function(t){i._buttonTouch(e,t)}),Hammer(e).on("tap",function(t){i._buttonTap(e,t)}),Hammer(e).on("release",function(t){i._buttonRelease(e,t)})},this._inits.link=function(e){i._inits.button(e)},this._inits.pane=function(e){var t=i._getCache(e);t._allowchilddrags=e.getAttribute("data-tulito-allowchilddrags"),e.addEventListener("transitionend",function(n){n.srcElement.getAttribute("data-tulito-class")==="pane"&&n.propertyName.match(/-transform$/)&&t._backpane&&(i._hasClass(e,"opened")||i._removeClass(t._backpane,"shown"))},!1),i._shoveBackpanes(e);var n=e.getAttribute("data-tulito-drag");if(n==="none")return;if(n==="never")return;Hammer(e).on("dragstart",function(n){if(n.srcElement!==e&&t._allowchilddrags!=="yes")return;if(e.getAttribute("data-tulito-drag")==="disabled"){t._thisdrag=null;return}t._opened?i._startOpenPaneDrag(n,e,t):i._startClosedPaneDrag(n,e,t)}),Hammer(e).on("drag",function(n){if(n.srcElement!==e&&t._allowchilddrags!=="yes")return;t._opened===!1&&n.gesture.direction===t._thisdrag?i._dragPane(n,e,t):t._opened===!0&&n.gesture.direction!==t._thisdrag&&i._dragPane(n,e,t,!0)}),Hammer(e).on("dragend",function(n){if(n.srcElement!==e&&t._allowchilddrags!=="yes")return;t._opened===!0&&n.gesture.direction!==t._thisdrag?i._endOpenPaneDrag(n,e,t):t._opened===!1&&n.gesture.direction===t._thisdrag?i._endClosedPaneDrag(n,e,t):i._resetTranslate(e,!0)})},this._inits["hidden-pane"]=function(t){var r=i._getCache(t);t.addEventListener("transitionend",function(e){e.srcElement.getAttribute("data-tulito-class")==="hidden-pane"&&e.propertyName.match(/-transform$/)&&(i._hasClass(e.srcElement,"opened")||i._removeClass(e.srcElement,"shown"))},!1);var s=t.getAttribute("data-tulito-drag");if(s==="none")return;if(s==="never")return;var o=t.getAttribute("data-tulito-pos"),u=t.getAttribute("data-tulito-shove");if(u){var a=document.querySelector('[data-tulito-id="'+u+'"]');r._shoveel=a;var f=i._getCache(a)}var l,c=l=t.getAttribute("data-tulito-panegap");l===null?l=i.options.openedHiddenPaneGap:l==="full"&&(l=0),r._panegap=c,Hammer(t).on("dragstart",function(e){i._addClass(t,"notransition"),r._shoveel&&i._addClass(r._shoveel,"notransition")}),Hammer(t).on("drag",function(n){n.gesture.direction===o&&(o==="right"?(i._translate(t,n.gesture.deltaX,0,0,{xMax:e.innerWidth,xMin:l}),r._shoveel&&i._translate(r._shoveel,n.gesture.deltaX*i.options.shovedHiddenRatio,0,0)):o==="left"?(i._translate(t,n.gesture.deltaX,0,0,{xMax:-l,xMin:-e.innerWidth}),r._shoveel&&i._translate(r._shoveel,n.gesture.deltaX*i.options.shovedHiddenRatio,0,0,{xMax:i.options.shovedPaneGap,xMin:0})):o==="up"?i._translate(t,0,n.gesture.deltaY,0,{yMax:-l,yMin:-e.innerHeight}):o==="down"&&i._translate(t,0,n.gesture.deltaY,0,{yMax:e.innerHeight,yMin:l}))}),Hammer(t).on("dragend",function(e){if(e.gesture.direction===o){i._removeClass(t,"notransition"),r._shoveel&&i._removeClass(r._shoveel,"notransition");if(o==="left"||o==="right")Math.abs(e.gesture.deltaX)>n?(r._opened=!r._opened,i._removeClass(t,"opened"),i._resetTranslate(t),r._shoveel&&(i._resetTranslate(r._shoveel),i._removeClass(r._shoveel,"shovedleft"),i._removeClass(r._shoveel,"shovedright")),i.options.onHiddenPaneHidden&&i.options.onHiddenPaneHidden(t),setTimeout(function(){i._toggleControlsOn()},200)):(i._resetTranslate(t,!0),r._shoveel&&i._resetTranslate(r._shoveel,!0));if(o==="up"||o==="down")Math.abs(e.gesture.deltaY)>n?(r._opened=!r._opened,i._removeClass(t,"opened"),i._resetTranslate(t),i.options.onHiddenPaneHidden&&i.options.onHiddenPaneHidden(t),setTimeout(function(){i._toggleControlsOn()},200)):i._resetTranslate(t,!0)}else i._resetTranslate(t)})},this._inits["back-pane"]=function(e){},this._buttonTouch=function(e,t){if(!e)return;this._addClass(e,"active")},this._buttonTap=function(e,t){if(!e)return;if(e.hasAttribute("data-tulito-toggle"))if(e.hasAttribute("data-tulito-toggledelay")){var n=function(e,t,n){setTimeout(function(){i._togglePane(e,t)},n)},r=e.getAttribute("data-tulito-toggledelay"),s=0;e.getAttribute("data-tulito-toggle").split(/\s+/).forEach(function(e){var i=e.split(":");i[1]?n(document.querySelector('[data-tulito-id="'+e+'"].'+i[1]),t,s):n(document.querySelector('[data-tulito-id="'+e+'"]'),t,s),s+=r})}else e.getAttribute("data-tulito-toggle").split(/\s+/).forEach(function(e){var n=e.split(":");n[1]?i._togglePane(document.querySelector('[data-tulito-id="'+n[0]+'"].'+n[1]),t):i._togglePane(document.querySelector('[data-tulito-id="'+e+'"]'),t)})},this._buttonRelease=function(e,t){if(!e)return;setTimeout(function(){i._removeClass(e,"active")},200)},this._togglePane=function(e,t){if(!e)return;var n=i._getCache(e),r=e.getAttribute("data-tulito-class");r==="hidden-pane"?i._toggleHiddenPane(t,e,n):r==="back-pane"&&i._toggleBackPane(t,e,n)},this._addClass=function(e,t){e.className=e.className+" "+t},this._hasClass=function(e,t){var n=new RegExp("\\s*\\b"+t+"\\b","g");return n.test(e.className)},this._removeClass=function(e,t){var n=new RegExp("\\s*\\b"+t+"\\b","g");e.className=e.className.replace(n,"")},this._translate=function(e,n,r,i,s){var o=this._getCache(e),u=o._tx+n,a=o._ty+r,f=o._tz+i;s&&(s.xMax!=t&&(u=Math.min(u,s.xMax)),s.xMin!==t&&(u=Math.max(u,s.xMin)),s.yMax!=t&&(a=Math.min(a,s.yMax)),s.yMin!==t&&(a=Math.max(a,s.yMin))),e.style.webkitTransform="translate("+u+"px,"+a+"px)"+"translateZ("+f+"px)",e.style.msTransform=e.style.MozTransform=e.style.OTransform="translateX("+u+"px,"+a+"px)"},this._translateEnd=function(e,t,n,r,i,s){var o=this._getCache(e);i&&(o._tx+t>i.xMax&&(o._tx=i.xMax,t=0),o._tx+t<i.xMin&&(o._tx=i.xMin,t=0)),s?(o._tx=t,o._ty=n,o._tz=r):(o._tx=o._tx+t,o._ty=o._ty+n,o._tz=o._tz+r),e.style.webkitTransform="translate(0,0,0)",e.style.msTransform=e.style.MozTransform=e.style.OTransform="translateX(0,0)"},this._resetTranslate=function(e,t){this._removeClass(e,"notransition");var n=this._getCache(e);t!==!0&&(n._tx=0,n._ty=0,n._tz=0),setTimeout(function(){e.style.webkitTransform=e.style.msTransform=e.style.MozTransform=e.style.OTransform=""},1)},this._orient=function(){var t=navigator.userAgent.match(/(iPad|iPhone|iPod)/g),n=document.querySelector('meta[name="viewport"]');t&&n&&(n.content.match(/width=device-width/)&&(n.content=n.content.replace(/width=[^,]+/,"width=1")),n.content=n.content.replace(/width=[^,]+/,"width="+e.innerWidth),n.content=n.content.replace(/height=[^,]+/,"height="+e.innerHeight)),less.modifyVars({"@screenWidth":e.innerWidth+"px","@screenHeight":e.innerHeight+"px","@openedPaneGap":i.options.openedPaneGap+"px","@openedHiddenPaneGap":i.options.openedHiddenPaneGap+"px","@shovedPaneGap":i.options.shovedPaneGap+"px"}),e.orientation===0?(document.documentElement.style.overflow="",document.body.style.height="100%"):(document.documentElement.style.overflow="",document.body.style.height="100%"),i.options.onOrientationChange&&i.options.onOrientationChange()},this._toggleControlsOffExcept=function(e){var t=document.querySelectorAll('[data-tulito-class="button"], input, textarea, button, .hscroller-cont');for(var n=0;n<t.length;++n)i._addClass(t[n],"inactive");if(e){var r=e.querySelectorAll('[data-tulito-class="button"], input, textarea, button, .hscroller-cont');for(var n=0;n<r.length;++n)i._removeClass(r[n],"inactive")}},this._toggleControlsOn=function(){var e=document.querySelectorAll('[data-tulito-class="button"], input, textarea, button, .hscroller-cont');for(var t=0;t<e.length;++t)i._removeClass(e[t],"inactive")},this._hideAllBackpanes=function(){var e=document.querySelectorAll('[data-tulito-class="back-pane"]');for(var t=0;t<e.length;++t)i._removeClass(e[t],"shown")},this._hideAllHiddenPanes=function(){var e=document.querySelectorAll('[data-tulito-class="hidden-pane"]');for(var t=0;t<e.length;++t)i._removeClass(e[t],"shown")},this._getCache=function(e){var t=e.getAttribute("id");if(!t){t=e.getAttribute("data-tulito-id");if(!t)return}return r[t]?r[t]:(r[t]={},r[t].el=e,r[t]._tx=r[t]._ty=r[t]._tz=0,r[t]._opened=!1,r[t]._thisdrag=null,r[t])},this._getBackpanes=function(e){return e?document.querySelectorAll('[data-tulito-class="back-pane"][data-tulito-parent="'+e.getAttribute("data-tulito-id")+'"]'):document.querySelectorAll('[data-tulito-class="back-pane"]')},this._shoveBackpanes=function(n){var r=i._getBackpanes(n);for(var s=0;s<r.length;++s){var o=i._getCache(r[s]),u=r[s].getAttribute("data-tulito-shovedist");if(u===null||u===t)u=i.options.shovedPaneGap;u==="full"&&(u=e.innerWidth);var a=r[s].getAttribute("data-tulito-shovedir");a==="right"?(i._addClass(r[s],"shovedleft"),i._translateEnd(r[s],-u,0,0)):a==="left"&&(i._addClass(r[s],"shovedright"),i._translateEnd(r[s],u,0,0))}},this._startClosedPaneDrag=function(e,t,n){i._addClass(t,"notransition"),n._backpane&&i._removeClass(n._backpane,"shown");var r=i._getBackpanes(t),s=!1;for(var o=0;o<r.length;++o){if(r[o].getAttribute("data-tulito-parentdrag")===e.gesture.direction){n._backpane=r[o],n._shovedir=r[o].getAttribute("data-tulito-shovedir"),n._thisdrag=e.gesture.direction,i._addClass(r[o],"shown"),i._addClass(r[o],"notransition"),i.options.onBackPaneShown&&i.options.onBackPaneShown(t),s=!0;continue}i._removeClass(r[o],"shown")}s||(n._thisdrag=null)},this._startOpenPaneDrag=function(e,t,n){i._addClass(t,"notransition"),n._backpane&&n._shovedir&&i._addClass(n._backpane,"notransition")},this._dragPane=function(t,n,r,s){r._thisdrag==="right"?(i._translate(n,t.gesture.deltaX,0,0,{xMax:(e.innerWidth-i.options.openedPaneGap)*1.1,xMin:0}),r._backpane&&r._shovedir&&(r._shovedir==="right"?i._translate(r._backpane,t.gesture.deltaX*i.options.shovedPaneRatio,0,0,{xMax:0,xMin:-i.options.shovedPaneGap}):r._shovedir==="left"&&i._translate(r._backpane,t.gesture.deltaX*i.options.shovedPaneRatio,0,0,{xMax:i.options.shovedPaneGap,xMin:0}))):r._thisdrag==="left"&&(s?i._translate(n,t.gesture.deltaX,0,0,{xMax:0,xMin:-(e.innerWidth-i.options.openedPaneGap)}):i._translate(n,t.gesture.deltaX,0,0,{xMax:e.innerWidth,xMin:-(e.innerWidth-i.options.openedPaneGap*.9)}),r._backpane&&r._shovedir&&(r._shovedir==="right"?i._translate(r._backpane,t.gesture.deltaX*i.options.shovedPaneRatio,0,0):r._shovedir==="left"&&i._translate(r._backpane,t.gesture.deltaX*i.options.shovedPaneRatio,0,0,{xMax:i.options.shovedPaneGap,xMin:0})))},this._endOpenPaneDrag=function(e,t,r){i._removeClass(t,"notransition"),i._resetTranslate(t,!0),Math.abs(e.gesture.deltaX)>n?(i._removeClass(t,"opened"),i._resetTranslate(t),r._opened=!1,i.options.onBackPaneHidden&&i.options.onBackPaneHidden(t),r._backpane&&r._shovedir&&(i._removeClass(r._backpane,"notransition"),i._resetTranslate(r._backpane,!0),r._shovedir==="right"?(i._translateEnd(r._backpane,-i.options.shovedPaneGap,0,0),i._addClass(r._backpane,"shovedleft")):r._shovedir==="left"&&(i._translateEnd(r._backpane,i.options.shovedPaneGap,0,0),i._addClass(r._backpane,"shovedright"))),setTimeout(function(){i._removeClass(t,"draggedleft"),i._removeClass(t,"draggedright")},200),setTimeout(function(){i._toggleControlsOn()},200)):r._backpane&&r._shovedir&&(i._removeClass(r._backpane,"notransition"),i._resetTranslate(r._backpane,!0),r._backpane&&r._shovedir&&(i._removeClass(r._backpane,"notransition"),i._resetTranslate(r._backpane,!0)))},this._endClosedPaneDrag=function(t,r,s){i._removeClass(r,"notransition"),i._resetTranslate(r,!0),Math.abs(t.gesture.deltaX)>n?(i._addClass(r,"opened"),s._opened=!0,s._thisdrag==="right"?(i._addClass(r,"draggedright"),i._translateEnd(r,e.innerWidth-i.options.openedPaneGap,0,0,null,!0)):s._thisdrag==="left"&&(i._addClass(r,"draggedleft"),i._translateEnd(r,-(e.innerWidth-i.options.openedPaneGap),0,0,null,!0)),s._shovedir==="right"?i._removeClass(s._backpane,"shovedleft"):s._shovedir==="left"&&i._removeClass(s._backpane,"shovedright"),s._backpane&&(i._removeClass(s._backpane,"notransition"),s._shovedir&&(i._resetTranslate(s._backpane,!0),i._translateEnd(s._backpane,0,0,0,null,!0))),i._toggleControlsOffExcept(s._backpane)):(i._resetTranslate(r,!0),s._backpane&&(i._removeClass(s._backpane,"notransition"),s._shovedir&&i._resetTranslate(s._backpane,!0)),setTimeout(function(){i._toggleControlsOn()},200))},this._toggleHiddenPane=function(e,t,n){var r=t.getAttribute("data-tulito-pos"),s=t.getAttribute("data-tulito-shove"),o,u=o=t.getAttribute("data-tulito-panegap"),a=document.querySelector('[data-tulito-id="'+s+'"]');n._shoveel=a,n._panegap=o,o===null?o=i.options.openedHiddenPaneGap:o==="full"&&(o=0),n._opened?(n._opened=!1,s&&(r==="left"?(i._removeClass(n._shoveel,"shovedright"),i._resetTranslate(n._shoveel,!0)):r==="right"&&(i._removeClass(n._shoveel,"shovedleft"),i._resetTranslate(n._shoveel,!0))),setTimeout(function(){i._toggleControlsOn()},200),n._opened=!1,i.options.onHiddenPaneHidden&&i.options.onHiddenPaneHidden(t),setTimeout(function(){i._removeClass(t,"opened"),u==="full"&&i._removeClass(t,"full-pane")},1)):(s&&(r==="left"?(setTimeout(function(){i._addClass(n._shoveel,"shovedright")},50),i._translateEnd(n._shoveel,i.options.shovedPaneGap*1.1,0,0,null,!0)):r==="right"&&(setTimeout(function(){i._addClass(n._shoveel,"shovedleft")},50),i._translateEnd(n._shoveel,-(i.options.shovedPaneGap*1.1),0,0,null,!0))),t.getAttribute("data-tulito-controls")!=="leave"&&i._toggleControlsOffExcept(t),i._addClass(t,"shown"),u==="full"&&i._addClass(t,"full-pane"),n._opened=!0,r==="left"?i._translateEnd(t,-o,0,0,null,!0):r==="right"?i._translateEnd(t,o,0,0,null,!0):r==="up"?i._translateEnd(t,0,o,0,null,!0):r==="down"&&i._translateEnd(t,0,-o,0,null,!0),i.options.onHiddenPaneShown&&i.options.onHiddenPaneShown(t),setTimeout(function(){i._addClass(t,"opened")},1))},this._toggleBackPane=function(t,n,r){var s=n.getAttribute("data-tulito-parent"),o=document.querySelector('[data-tulito-id="'+s+'"]'),u=n.getAttribute("data-tulito-shovedir"),a,f=a=n.getAttribute("data-tulito-shovedist"),l=i._getCache(o);r._shovedist=a,a===null?a=i.options.shovedPaneGap:a==="full"&&(a=e.innerWidth);if(l._opened){u&&(i._removeClass(n,"notransition"),i._resetTranslate(n));var c=n.getAttribute("data-tulito-parentdrag");c==="left"?(i._removeClass(o,"draggedleft"),u==="right"?(i._addClass(n,"shovedleft"),i._translateEnd(n,-a,0,0,null,!0)):u==="left"&&(i._addClass(n,"shovedright"),i._translateEnd(n,a,0,0,null,!0))):c==="right"&&(i._removeClass(o,"draggedright"),u==="right"?(i._addClass(n,"shovedleft"),i._translateEnd(n,-a,0,0,null,!0)):u==="left"&&(i._addClass(n,"shovedright"),i._translateEnd(n,a,0,0,null,!0))),i._removeClass(o,"opened"),f==="full"&&i._removeClass(o,"full-pane"),l._opened=!1,i._resetTranslate(o),i.options.onBackPaneHidden&&i.options.onBackPaneHidden(n),setTimeout(function(){i._toggleControlsOn()},200)}else{l._backpane=n,l._shovedir=u,i._toggleControlsOffExcept(n),i._addClass(n,"shown"),f==="full"&&i._addClass(o,"full-pane"),i._addClass(o,"opened"),l._opened=!0,i._resetTranslate(o,!0),u&&(i._removeClass(n,"notransition"),i._resetTranslate(n,!0)),i.options.onBackPaneShown&&i.options.onBackPaneShown(n);var h=n.getAttribute("data-tulito-parentdrag");h==="right"?(l._thisdrag="right",i._addClass(o,"draggedright"),i._translateEnd(o,e.innerWidth-i.options.openedPaneGap,0,0,null,!0),u==="left"?(setTimeout(function(){i._removeClass(n,"shovedright")},0),i._translateEnd(n,0,0,0,null,!0)):u==="right"&&(setTimeout(function(){i._removeClass(n,"shovedleft")},0),i._translateEnd(n,0,0,0,null,!0))):h==="left"&&(l._thisdrag="left",i._addClass(o,"draggedleft"),i._translateEnd(o,-(e.innerWidth-i.options.openedPaneGap),0,0,null,!0),u==="left"?(setTimeout(function(){i._removeClass(n,"shovedright")},0),i._translateEnd(n,0,0,0,null,!0)):u==="right"&&(setTimeout(function(){i._removeClass(n,"shovedleft")},0),i._translateEnd(n,0,0,0,null,!0)))}},this};typeof define=="function"&&typeof define.amd=="object"&&define.amd?define(function(){return new i}):typeof module=="object"&&typeof module.exports=="object"?module.exports=new i:e.tulito=new i})(this);var ScrollFix=function(e){var t,n;e=e||document.querySelector(e);if(!e)return;e.addEventListener("touchstart",function(r){t=r.touches[0].pageY,n=e.scrollTop,n<=0&&(e.scrollTop=1),n+e.offsetHeight>=e.scrollHeight&&(e.scrollTop=e.scrollHeight-e.offsetHeight-1)},!1)};